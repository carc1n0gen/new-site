1:HL["/_next/static/css/a47186471fe47bfc.css",{"as":"style"}]
0:["oLZAL6tVYjSWsQsQmwOJB",[[["",{"children":[["year","2014","d"],{"children":[["month","07","d"],{"children":[["day","25","d"],{"children":[["slug","create-an-async-chat-server-and-client-with-dart","d"],{"children":["__PAGE__?{\"year\":\"2014\",\"month\":\"07\",\"day\":\"25\",\"slug\":\"create-an-async-chat-server-and-client-with-dart\"}",{}]}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a47186471fe47bfc.css","precedence":"next"}]],["$L3",null]]]]]
4:I{"id":7095,"chunks":["95:static/chunks/95-b42e21927908bec6.js","224:static/chunks/224-45995354792692c9.js","106:static/chunks/app/[year]/[month]/[day]/[slug]/page-fd3e7a5daa90e646.js"],"name":"","async":false}
5:I{"id":7289,"chunks":["296:static/chunks/2e3a737e-3351b73765f36319.js","95:static/chunks/95-b42e21927908bec6.js","185:static/chunks/app/layout-f2ff0e98e2a51352.js"],"name":"","async":false}
6:I{"id":9180,"chunks":["272:static/chunks/webpack-5707d349cb82335a.js","253:static/chunks/bce60fc1-3d7875a7a6202410.js","698:static/chunks/698-4595f783858dddc6.js"],"name":"default","async":false}
7:I{"id":2306,"chunks":["272:static/chunks/webpack-5707d349cb82335a.js","253:static/chunks/bce60fc1-3d7875a7a6202410.js","698:static/chunks/698-4595f783858dddc6.js"],"name":"default","async":false}
a:I{"id":9880,"chunks":["296:static/chunks/2e3a737e-3351b73765f36319.js","95:static/chunks/95-b42e21927908bec6.js","185:static/chunks/app/layout-f2ff0e98e2a51352.js"],"name":"","async":false}
9:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z2:[["$","html",null,{"lang":"en","className":"dark:bg-black md:bg-zinc-50 md:dark:bg-zinc-800","children":[["$","link",null,{"rel":"alternate","type":"application/atom+xml","title":"Atom Feed for Carson's Blog","href":"/feed.xml"}],["$","body",null,{"className":"text-zinc-700 dark:text-zinc-300","children":[["$","header",null,{"className":"bg-white dark:bg-black text-center md:text-left mt-5 md:mt-0 md:pt-10 border-b border-b-zinc-300 dark:border-b-zinc-600","children":[["$","div",null,{"className":"md:max-w-screen-md px-2 md:px-0 mx-auto","children":[["$","img",null,{"src":"/img/avatar-new.jpg","alt":"Avatar photo","className":"rounded-full mx-auto md:float-right md:-mt-4","width":"100","height":"100"}],["$","div",null,{"className":"mt-5","children":[["$","$L4",null,{"href":"/","className":"mt-2","children":["$","h1",null,{"className":"text-5xl font-bold","children":"Carson's Blog"}]}],["$","p",null,{"className":"mt-2","children":"Somewhat coherent tutorials about web stuff and things."}]]}]]}],["$","$L5",null,{}]]}],["$","main",null,{"className":"px-4 py-2 md:p-0 md:max-w-screen-md mx-auto","children":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":["$","section",null,{"className":"mt-6 p-6 bg-white border border-zinc-300","children":[["$","h1",null,{"className":"font-bold text-3xl mb-4","children":"Not Found"}],["$","p",null,{"children":"Are you lost? There doesn't seem to be anything here"}]]}],"notFoundStyles":[],"childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children",["year","2014","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children",["year","2014","d"],"children",["month","07","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children",["year","2014","d"],"children",["month","07","d"],"children",["day","25","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children",["year","2014","d"],"children",["month","07","d"],"children",["day","25","d"],"children",["slug","create-an-async-chat-server-and-client-with-dart","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L8",null],"segment":"__PAGE__?{\"year\":\"2014\",\"month\":\"07\",\"day\":\"25\",\"slug\":\"create-an-async-chat-server-and-client-with-dart\"}"},"styles":[]}],"segment":["slug","create-an-async-chat-server-and-client-with-dart","d"]},"styles":[]}],"segment":["day","25","d"]},"styles":[]}],"segment":["month","07","d"]},"styles":[]}],"segment":["year","2014","d"]},"styles":[]}]}],["$","footer",null,{"className":"mt-6 mb-6 flex items-center justify-center","children":["© Carson Evans"," ",["$","$L4",null,{"href":"https://github.com/carc1n0gen","target":"_blank","className":"ml-5","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 496 512","className":"inline","children":["$undefined",[["$","path","0",{"d":"$9","children":"$undefined"}]]],"style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}],["$","$L4",null,{"href":"https://www.instagram.com/carsonphotosandstuff/","target":"_blank","className":"ml-3","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 448 512","className":"inline","children":["$undefined",[["$","path","0",{"d":"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z","children":"$undefined"}]]],"style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}],["$","$L4",null,{"href":"/feed.xml","target":"_blank","className":"ml-3","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 448 512","className":"inline","children":["$undefined",[["$","path","0",{"d":"M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z","children":"$undefined"}]]],"style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}]}]]}],["$","$La",null,{}]]}]]}],null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Create an Async Chat Server and Client With Dart - Carson's Blog"}],["$","meta","2",{"name":"description","content":"Before starting this tutorial you should be familiar with my previous post about creating your first webapp in dart.  In this tutorial we are going to make two Dart projects.  The first one will be a command line application for the server, the second one will be a web application for the client.  We will be using WebSockets for communication between server and client."}],["$","meta","3",{"name":"keywords","content":"chat async dart"}],["$","meta","4",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","5",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]]
f:I{"id":4368,"chunks":["95:static/chunks/95-b42e21927908bec6.js","224:static/chunks/224-45995354792692c9.js","106:static/chunks/app/[year]/[month]/[day]/[slug]/page-fd3e7a5daa90e646.js"],"name":"","async":false}
b:T453,<span class="hljs-keyword">if</span> (WebsocketTransformer.isUpgradeRequest(request)) {
  WebSocketTransformer.upgrade(request).then((WebSocket ws) {
    connections.add(ws);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Client connected, there are now <span class="hljs-subst">${connections.length}</span> client(s) connected.&#x27;</span>);
    ws.listen((<span class="hljs-built_in">String</span> message) {
      <span class="hljs-keyword">for</span> (WebSocket connection <span class="hljs-keyword">in</span> connections) {
        connection.add(message);
      }
    },
    onDone: () {
      connections.remove(ws);
      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Client disconnected, there are now <span class="hljs-subst">${connections.legnth}</span> client(s) connected.&#x27;</span>);
    });
  });
} <span class="hljs-keyword">else</span> {
  request.response.statusCode = HttpStatus.FORBIDDEN;
  request.response.reasonPhrase = <span class="hljs-string">&#x27;Websocket connections only!&#x27;</span>;
  request.response.close();
}c:T7b3,<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:io&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> PORT = <span class="hljs-number">9090</span>;

<span class="hljs-built_in">List</span>&lt;WebSocket&gt; connections;

<span class="hljs-keyword">void</span> main() {
  connections = <span class="hljs-keyword">new</span> <span class="hljs-built_in">List</span>&lt;WebSocket&gt;();

  HttpServer.bind(InternetAddress.ANY_IP_V4, PORT).then((HttpServer server) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Server listening on port <span class="hljs-subst">${PORT}</span>.&#x27;</span>);
    server.listen((HttpRequest request) {
      <span class="hljs-keyword">if</span> (WebSocketTransformer.isUpgradeRequest(request)) {
        WebSocketTransformer.upgrade(request).then((WebSocket ws) {
          connections.add(ws);
          <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Client connected, there are now <span class="hljs-subst">${connections.length}</span> client(s) connected.&#x27;</span>);
          ws.listen((<span class="hljs-built_in">String</span> message) {
            <span class="hljs-keyword">for</span> (WebSocket connection <span class="hljs-keyword">in</span> connections) {
              connection.add(message);
            }
          },
          onDone: () {
            connections.remove(ws);
            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Client disconnected, there are now <span class="hljs-subst">${connections.length}</span> client(s) connected.&#x27;</span>);
          });
        });
      } <span class="hljs-keyword">else</span> {
        request.response.statusCode = HttpStatus.FORBIDDEN;
        request.response.reasonPhrase = <span class="hljs-string">&#x27;Websocket connections only!&#x27;</span>;
        request.response.close();
      }
    });
  });
}d:T854,<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ChatClient<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nickname&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;savenickname&quot;</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;output&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;input&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;send&quot;</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/dart&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;chatclient.dart&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;packages/browser/dart.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>e:T7c6,<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:html&#x27;</span>;

<span class="hljs-keyword">void</span> main() {
  InputElement nickname = <span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#nickname&#x27;</span>);
  DivElement output = <span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#output&#x27;</span>);
  TextAreaElement input = <span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#input&#x27;</span>);
  ButtonElement send = <span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#send&#x27;</span>);
  ButtonElement savenickname = <span class="hljs-built_in">querySelector</span>(<span class="hljs-string">&#x27;#savenickname&#x27;</span>);
  WebSocket ws = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&#x27;ws://localhost:9090&#x27;</span>);

  savenickname.onClick.listen((MouseEvent event) {
    <span class="hljs-keyword">if</span> (nickname.value != <span class="hljs-string">&#x27;&#x27;</span>) {
      nickname.readOnly = <span class="hljs-keyword">true</span>;
    }
  });

  send.onClick.listen((MouseEvent event) {
    <span class="hljs-keyword">if</span> (nickname.value != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; nickname.readOnly) {
      <span class="hljs-built_in">String</span> message = input.value;
      input.value = <span class="hljs-string">&#x27;&#x27;</span>;
      input.focus();
      ws.send(<span class="hljs-string">&quot;<span class="hljs-subst">${nickname.value}</span>: <span class="hljs-subst">${message}</span>&quot;</span>);
    }
  });

  ws.addEventListener(<span class="hljs-string">&#x27;message&#x27;</span>, (event) {
    Message msg = <span class="hljs-keyword">new</span> Message.FromJson(event.data);
    output.innerHtml += <span class="hljs-string">&#x27;&lt;p&gt;<span class="hljs-subst">${message}</span>&lt;/p&gt;&#x27;</span>;
  });
}8:["$","article",null,{"className":"mt-6 md:p-6 bg-white dark:bg-black md:border border-zinc-300 dark:border-zinc-600 undefined","children":[["$","header",null,{"children":[["$","$L4",null,{"href":"/2014/07/25/create-an-async-chat-server-and-client-with-dart","children":["$","h2",null,{"className":"text-3xl font-bold mb-2","children":"Create an Async Chat Server and Client With Dart"}]}],["$","p",null,{"className":"mb-4 text-sm text-zinc-500","children":["posted by ","Carson Evans"," ·"," ","Jul 25, 2014"]}]]}],["$","section",null,{"children":["Before starting this tutorial you should be familiar with my previous post about creating your first webapp in dart.  In this tutorial we are going to make two Dart projects.  The first one will be a command line application for the server, the second one will be a web application for the client.  We will be using WebSockets for communication between server and client.","\n",["$","h2",null,{"className":"text-2xl font-bold mt-6 mb-2","children":"Creating the server"}],"\n",["$","p",null,{"className":"my-4","children":["Open up the Dart IDE and start a new project. Name it ChatServer and pick the ",["$","code",null,{"className":"font-bold","children":"Command-line application"}]," template. A command line application means this project has no GUI, it just runs in the command prompt or terminal. The default command line application has a bin folder with one main script that acts as the entry point for the application. The script should look something like this:"]}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-keyword\">void</span> main() {\n  <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Hello, World!&quot;</span>);\n}"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Above the main function we need to add an import, create a constant to hold the port the server will listen too, and create a list to hold web socket connections:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;dart:io&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-built_in\">int</span> PORT = <span class=\"hljs-number\">9090</span>;\n\n<span class=\"hljs-built_in\">List</span>&lt;WebSocket&gt; connections;"}}]}],"\n",["$","p",null,{"className":"my-4","children":["In Dart, to make a websocket server you make a http server and ",["$","em",null,{"children":"transform"}]," it into a websocket server. Delete the contents of the main function, initialize the connections list, and bind an http server using the constant we made earlier as the port number:"]}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;dart:io&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-built_in\">int</span> PORT = <span class=\"hljs-number\">9090</span>;\n\n<span class=\"hljs-built_in\">List</span>&lt;WebSocket&gt; connections;\n\n<span class=\"hljs-keyword\">void</span> main() {\n  connections = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">List</span>&lt;WebSocket&gt;();\n\n  HttpServer.bind(InternetAddress.ANY_UP_V4, PORT).then((HttpServer server) {\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;Server listening on port <span class=\"hljs-subst\">${PORT}</span>.&#x27;</span>);\n  });\n}"}}]}],"\n",["$","p",null,{"className":"my-4","children":["This syntax might look a little strange to people not familiar Dart or asynchronous programming. The ",["$","code",null,{"className":"font-bold","children":"bind"}]," method of the HttpServer class is asynchronous and will return an instance of a HttpServer some time in the future. All asynchronous methods in Dart act this way and have a ",["$","code",null,{"className":"font-bold","children":"then"}]," method that is called when they are done. You provide the ",["$","code",null,{"className":"font-bold","children":"then"}]," method with a callback that accepts the type returned by the asynchronous method. This callback is executed when the asynchronous method is complete and the ",["$","code",null,{"className":"font-bold","children":"then"}]," method is run. In our case, we are passing an anonymous function as a callback to the ",["$","code",null,{"className":"font-bold","children":"then"}]," method, and all this callback does at this point is print what port the server is listening on."]}],"\n",["$","p",null,{"className":"my-4","children":"Now lets make the http server listen for requests:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&#x27;Server listening on port <span class=\"hljs-subst\">${PORT}</span>.&#x27;</span>);\nserver.listen((HttpRequest request) {\n  <span class=\"hljs-keyword\">if</span> (WebsocketTransformer.isUpgradeRequest(request)) {\n    <span class=\"hljs-comment\">// Transform to websocket</span>\n  } <span class=\"hljs-keyword\">else</span> {\n    request.response.statusCode = HttpStatus.FORBIDDEN;\n    request.response.reasonPhrase = <span class=\"hljs-string\">&#x27;Websocket connections only!&#x27;</span>;\n    request.response.close();\n  }\n});"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Here we are checking if the request is a websocket request and if it is not then we send the client connecion an error message. Next we will do the websocket work."}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"$b"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Here we transform the request to a websocket connection and add it to our list of connections. Then we listen for messages coming from the websocket connection and send that message to every connection in the list of connections."}],"\n",["$","p",null,{"className":"my-4","children":"The complete code should look like this:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"$c"}}]}],"\n",["$","p",null,{"className":"my-4","children":"You can now run this project, but it doesn't do anything because there is no client to connect with"}],"\n",["$","h2",null,{"className":"text-2xl font-bold mt-6 mb-2","children":"Creating the client"}],"\n",["$","p",null,{"className":"my-4","children":["Start another new project with the name ChatClient with the ",["$","code",null,{"className":"font-bold","children":"Web application"}]," template. In Dart web applications have a web folder where everything will go. By default there will be a html, css, and dart file. Open up the html file and delete everything inside the body tags then add the following:"]}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"$d"}}]}],"\n",["$","p",null,{"className":"my-4","children":["The first input is where you will enter your nickname with a button that saves it. Then there is a ",["$","code",null,{"className":"font-bold","children":"div"}]," that will be used for do display chat messages, a ",["$","code",null,{"className":"font-bold","children":"textarea"}]," for chat input, and a send button for sending message to the server. At the end there is two script references."]}],"\n",["$","p",null,{"className":"my-4","children":"The first script reference is the main Dart script for the web application and is where we will be coding our logic. The second script is a special script used to detect if the web browser supports Dart or not and will fallback to the JavaScript compiled version of the web app."}],"\n",["$","p",null,{"className":"my-4","children":"Open up the css file and delete everything and add the following:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-selector-id\">#output</span> {\n  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">600px</span>;\n  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">400px</span>;\n  <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span> auto;\n}"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Open up the Dart script and delete everything below the main function and inside the main function. Above the main function add an import for DOM support:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;dart:html&#x27;</span>;"}}]}],"\n",["$","p",null,{"className":"my-4","children":["Inside the main function we need to select the elements we need with ",["$","code",null,{"className":"font-bold","children":"querySelector"}],":"]}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"<span class=\"hljs-keyword\">void</span> main() {\n  InputElement nickname = <span class=\"hljs-built_in\">querySelector</span>(<span class=\"hljs-string\">&#x27;#nickname&#x27;</span>);\n  DivElement output = <span class=\"hljs-built_in\">querySelector</span>(<span class=\"hljs-string\">&#x27;#output&#x27;</span>);\n  TextAreaElement input = <span class=\"hljs-built_in\">querySelector</span>(<span class=\"hljs-string\">&#x27;#input&#x27;</span>);\n  ButtonElement send = <span class=\"hljs-built_in\">querySelector</span>(<span class=\"hljs-string\">&#x27;#send&#x27;</span>);\n  ButtonElement savenickname = <span class=\"hljs-built_in\">querySelector</span>(<span class=\"hljs-string\">&#x27;#savenickname&#x27;</span>);\n}"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Next create a WebSocket connection:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"WebSocket ws = <span class=\"hljs-keyword\">new</span> WebSocket(<span class=\"hljs-string\">&#x27;ws://localhost:9090&#x27;</span>);"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Now when the save nickname button is clicked we need to make the nickname field read only."}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"savenickname.onClick.listen((MouseEvent event) {\n  <span class=\"hljs-keyword\">if</span> (nickname.value != <span class=\"hljs-string\">&#x27;&#x27;</span>) {\n    nickname.readOnly = <span class=\"hljs-keyword\">true</span>;\n  }\n});"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Then we make the send button actually send the contents of the input to the server. We only want to send the message if the nickname is read only (has been saved) and the input isnt empty:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"send.onClick.listen((MouseEvent event) {\n  <span class=\"hljs-keyword\">if</span> (nickname.value != <span class=\"hljs-string\">&#x27;&#x27;</span> &amp;&amp; nickname.readOnly) {\n    <span class=\"hljs-built_in\">String</span> message = input.value;\n    input.value = <span class=\"hljs-string\">&#x27;&#x27;</span>;\n    input.focus();\n    ws.send(<span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">${nickname.value}</span>: <span class=\"hljs-subst\">${message}</span>&quot;</span>);\n  }\n});"}}]}],"\n",["$","p",null,{"className":"my-4","children":["Finally we need to listen to the connection to the server for messages to display in the output ",["$","code",null,{"className":"font-bold","children":"div"}],":"]}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"ws.addEventListener(<span class=\"hljs-string\">&#x27;message&#x27;</span>, (event) {\n  <span class=\"hljs-built_in\">String</span> message = event.data;\n  output.innerHtml += <span class=\"hljs-string\">&#x27;&lt;p&gt;<span class=\"hljs-subst\">${message}</span>&lt;/p&gt;&#x27;</span>;\n});"}}]}],"\n",["$","p",null,{"className":"my-4","children":"Here is the complete code:"}],"\n",["$","pre",null,{"className":"my-4 -mx-4 md:-mx-[24px]","children":["$","code",null,{"className":"hljs bg-zinc-100 dark:bg-zinc-700","dangerouslySetInnerHTML":{"__html":"$e"}}]}],"\n",["$","h2",null,{"className":"text-2xl font-bold mt-6 mb-2","children":"Conclusion"}],"\n",["$","p",null,{"className":"my-4","children":"Now you can run the chat server, then run the chat client. Enter a nickname, enter a message and click send. You should then see your message. You can copy the url for the chat client and open multiple tabs and go to that url. Each tab will count as a new connection to the server so they can all talk to each other."}]]}],["$","footer",null,{"className":"mt-6","children":["$","$Lf",null,{"title":"Create an Async Chat Server and Client With Dart","postUrl":"/2014/07/25/create-an-async-chat-server-and-client-with-dart"}]}]]}]
